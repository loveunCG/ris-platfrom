<div class="page-footer">
    <div class="page-footer">
        2018 &copy;
        <a href="#" title="" target="_blank"> <!-- 网址：www.jianpeicn.com   邮箱： yingxiangyun@jianpeicn.com
               杭州健培科技有限公司   客服：0571-86668666 --></a>
    </div>
    <div class="scroll-to-top">
        <i class="icon-arrow-up"></i>
    </div>
</div>
<!-- END FOOTER -->
<!--[if lt IE 9]>
<script src="<?=base_url()?>assets/global/plugins/respond.min.js"></script>
<script src="<?=base_url()?>assets/global/plugins/excanvas.min.js"></script>
<![endif]-->
<script src="<?=base_url()?>assets/global/plugins/bootstrap-toastr/toastr.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/js.cookie.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/moment.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/bootstrap-daterangepicker/daterangepicker.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/morris/morris.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/pages/scripts/ui-extended-modals.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/morris/raphael-min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/fullcalendar/fullcalendar.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/scripts/datatable.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/scripts/jquery.form.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/scripts/dcalendar.picker.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/scripts/distpicker.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/scripts/jquery-confirm.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/datatables/datatables.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/pages/scripts/ui-modals.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/clockface/js/clockface.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/select2/js/select2.full.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/jquery-validation/js/jquery.validate.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/bootstrap-wizard/jquery.bootstrap.wizard.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/scripts/app.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/bootstrap-fileinput/bootstrap-fileinput.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/pages/scripts/ui-tree.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/jstree/dist/jstree.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/bootstrap-modal/js/bootstrap-modalmanager.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/bootstrap-modal/js/bootstrap-modal.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/scripts/app.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/ladda/spin.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/ladda/ladda.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/pages/scripts/ui-buttons.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/pages/scripts/portlet-draggable.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/select2/js/select2.full.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/pages/scripts/components-select2.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/pages/scripts/dashboard.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/pages/scripts/components-editors.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/bootstrap-markdown/lib/markdown.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/bootstrap-markdown/js/bootstrap-markdown.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/bootstrap-summernote/summernote.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/pages/scripts/form-wizard.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/layouts/layout2/scripts/layout.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/layouts/global/scripts/quick-sidebar.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/pages/scripts/form-validation-md.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/manual/custom.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/pages/scripts/components-date-time-pickers.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/pages/scripts/form-input-mask.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/pages/scripts/table-datatables-rowreorder.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/pages/scripts/contact.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/jquery-inputmask/jquery.inputmask.bundle.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/jquery.input-ip-address-control-1.0.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/bootstrap-wizard/jquery.bootstrap.wizard.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/plugins/jquery-validation/js/additional-methods.min.js" type="text/javascript"></script>
<script src="<?=base_url()?>assets/global/scripts/socket.io.js" type="text/javascript"></script>
<script>

    $(document).ready(function () {

        $('#upload_doc_btn').on('click', function () {
            var file_data = $('#upload_doc').prop('files')[0];
            var form_data = new FormData();
            var upload_doc_URL = "<?=base_url()?>" + "contact/upload_file";
            form_data.append('file', file_data);
            $.ajax({
                url: upload_doc_URL,
                cache: false,
                dataType: 'json',
                contentType: false,
                processData: false,
                data: form_data,
                type: 'post',
                success: function (response) {
                    $('#upload_doc_notification').addClass('alert alert-info').html(
                        response.status).delay(1000);
                    $('#upload_doc_file_path').val(response.real_path);
                },
                error: function (response) {
                    $('#upload_doc_notification').addClass('alert alert-warning').html(
                        response.status); // display error response from the server
                }
            });
        });
        $('#upload_dicom_btn').on('click', function () {
            var file_data = $('#upload_dicom').prop('files')[0];
            var form_data = new FormData();
            var upload_doc_URL = "<?=base_url()?>" + "contact/upload_file";
            form_data.append('file', file_data);
            $.ajax({
                url: upload_doc_URL, // point to server-side controller method
                cache: false,
                dataType: "json",
                contentType: false,
                processData: false,
                data: form_data,
                type: 'post',
                success: function (response) {
                    $('#upload_dicom_notification').addClass('alert alert-info').html(
                        response.status).delay(1000);
                    $('#upload_dicom_file_path').val(response.real_path); // display success response from the server
                },
                error: function (response) {
                    $('#upload_dicom_notification').addClass('alert alert-warning').html(
                        response.status); // display error response from the server
                }
            });
        });
        // $('#patient_birthday').dcalendarpicker();
        $('#from').dcalendarpicker();

        $('#to').dcalendarpicker();

        $('#start_time').dcalendarpicker();

        $('#end_time').dcalendarpicker();

        $('a.Delete').confirm({
            title: '删除病人信息',
            content: '您确定要删除该病人的信息吗？',
            autoClose: 'cancel|6000',
            type: 'red',
            typeAnimated: true,
            animationSpeed: 1000,
        });
        $('a.log-out').confirm({
            title: '您确定要退出吗?',
            icon:'fa fa-unlock',
            theme:'material',
            content: '您确定要退出吗？',
            autoClose: 'cancel|6000',
            typeAnimated: true,
            animationSpeed: 1000,
            buttons: {
                ok: {
                    text: '是',
                    action: function () {
                        var strURL = '<?=base_url()?>' + 'login/logout';
                        window.location.href = strURL;
                    }

                },
                cancel: {
                    text: '否'
                }
            }

        });
        setInterval(explode, 1000);
        setInterval(sessionCheck, 10000);
        $('#form_upload_doc').submit(function (e) {
            e.preventDefault();
            $.ajaxFileUpload({
                url: './upload/upload_file/',
                secureuri: false,
                fileElementId: 'upload_doc',
                dataType: 'json',
                data: {
                    'title': $('#title').val()
                },
                success: function (data) {
                    if (data.status != 'error') {
                        $('#files').html('<p>Reloading files...</p>');
                        refresh_files();
                        $('#title').val('');
                    }
                    alert(data.msg);
                }
            });
            return false;
        });
        $("#bs_confirmation_demo_1").confirm({
            text: "您真通过该报告？",
            title: "通过该报告",
            confirm: function (button) {
                submit_report();
            },
            cancel: function (button) {},
            confirmButton: "是",
            cancelButton: "否",
            post: true,
            confirmButtonClass: "btn-danger",
            cancelButtonClass: "btn-default",
            dialogClass: "modal-dialog modal-lg bg-blue "
        });
        $('#bs_confirmation_demo_2').confirm({
            title: '您确定要退出吗?',
            content: '您确定要退出吗？',
            autoClose: 'cancel|6000',
            type: 'red',
            typeAnimated: true,
            animationSpeed: 1000
        })
    });

    function sessionCheck() {
        var base_url = '<?=base_url()?>';
        var strURL = base_url + "login/sessionCheck";
        $.ajax({
            dataType: "json",
            url: strURL,
            success: function(response){
                if(response.status == "true") return true;
                $.alert({
                    title: '报告!',
                    content: '该用户从别的地方登录 检查你的账号信息 和 修改密码 点击 ‘OK’， 退出！',
                    columnClass: 'small',
                    icon: 'glyphicon glyphicon-info-sign',
                    theme: 'material',
                    autoClose: 'ok|5000',
                    buttons: {
                        ok: function () {
                            window.location.href='<?=base_url()?>'+'login/logout';
                        }
                    }
                });
            },
            error: function () {
                window.location.href='<?=base_url()?>'+'login/logout';
            }
        });
    }

    var explode = function () {
        var today = '<?=date('Y-m-d h: i: s ')?>';
        $('#clock_display').html(today);
    };
    var notificationAlert = io('<?=get_socket_url()?>');
    toastr.options = {
        "closeButton": true,
        "debug": false,
        "positionClass": "toast-top-right",
        "onclick": null,
        "showDuration": "1000",
        "hideDuration": "1000",
        "timeOut": "5000",
        "extendedTimeOut": "1000",
        "showEasing": "swing",
        "hideEasing": "linear",
        "showMethod": "fadeIn",
        "hideMethod": "fadeOut"
    };

    notificationAlert.on('webLoginOut', function(data){
        if(data.hasOwnProperty('usr_id')){
            if(data.usr_id == "<?=$this->session->userdata('usr_id')?>"){
                $.alert({

                    title: '报告!',
                    content: '该用户从别的装备登录 检查你的账号信息 和 修改密码 点击 ‘OK’， 退出！',
                    columnClass: 'small',
                    icon: 'glyphicon glyphicon-info-sign',
                    theme: 'material',
                    autoClose: 'ok|5000',
                    buttons: {
                            ok: function () {
                                    window.location.href='<?=base_url()?>'+'login/logout';
                            }
                    }
                });
            }
        }

    });

    notificationAlert.emit('alertLogin', {isweb:true, usr_id:'<?=$this->session->userdata('usr_id')?>'});

    notificationAlert.on('notificationLession', function (data) {
        if(data.hasOwnProperty('lession_id')){
            var strURL = '<?=base_url()?>' + 'school/get_school_info/'+data.lession_id;
            $.ajax({
                dataType: "json",
                url: strURL,
                success: function(response){
                    if(data.lession_status){
                        if(response.lession_doctor == "<?=$this->session->userdata('id')?>"){
                        }
                        else{
                            toastr.info(response.lession_title + '课程开始了！');
                        }
                    }else{//
                        toastr.info(response.lession_title+'课程结束了！');
                    }
                },
                error: function () {
                    window.location.href='<?=base_url()?>'+'login/logout';
                }
            });
        }
    });

</script>
